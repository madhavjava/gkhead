<?xml version="1.0" encoding="UTF-8"?>
<databaseChangeLog xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-2.0.xsd">
    <changeSet id="MIFOS-5985" author="Lukasz Gasior" context="expansion">
        <validCheckSum>3:3fb349d1d12d0fcf8d5fee9bff9b76d5</validCheckSum>
        <addColumn tableName="personnel">
            <column name="password_expiration_date" type="date" />
        </addColumn>
        <sql endDelimiter=";">
            create table personnel_used_password (
                id int auto_increment NOT NULL,
                personnel_id smallint(6) NOT NULL,
                password tinyblob not null,
                date_changed DATETIME not null,
                primary key(id),
                foreign key(personnel_id) 
                    references personnel(personnel_id)
            ) engine=innodb character set utf8;
        </sql>
        <rollback>
            <dropColumn tableName="personnel" columnName="password_expiration_date" />
            <sql endDelimiter=";">drop table personnel_used_password;</sql>
        </rollback>
    </changeSet>
    <changeSet id="MIFOS-5983" author="Lukasz Gasior" context="expansion">
        <addColumn tableName="sections_questions">
            <column name="show_on_page" type="boolean"  defaultValueBoolean="false" />
        </addColumn>
        <sql endDelimiter=";">
            create table information_order (
                id int auto_increment not null,
                name varchar(255) not null,
                additional_question_id int,
                page varchar(255) not null,
                order_ int not null,
                primary key(id)
            ) engine=innodb character set utf8;
            
            insert into information_order (name, page, order_) values
                ("displayName", "Client", 0), ("dateOfBirth", "Client", 1), ("handicapped", "Client", 2),
                ("phoneNumber", "Client", 3), ("address", "Client", 4), ("governmentId", "Client", 5),
                ("fatherName", "Client", 6), ("ethnicity", "Client", 7), ("educationLevel", "Client", 8),
                ("povertyStatus", "Client", 9), ("citizenship", "Client", 10), ("familyDetails", "Client", 11),
                ("city", "Client", 12), ("state", "Client", 13),
                
                ("interestRateType", "Loan", 0), ("interestRate", "Loan", 1), ("interestDeductedAtDisbursement", "Loan", 2),
                ("currency", "Loan", 3), ("frequencyOfInstalment", "Loan", 4), ("principalDueLastInstalment", "Loan", 5),
                ("gracePeriodType", "Loan", 6), ("gracePeriodDuration", "Loan", 7), ("noOfInstalments", "Loan", 8),
                ("sourceOfFund", "Loan", 9), ("newGlimAccounts", "Loan", 10), ("collateral", "Loan", 11),
                ("externalId", "Loan", 12), ("adminDocs", "Loan", 13), ("reccuringFees", "Loan", 14),
                ("oneTimeFees", "Loan", 15), ("reccuringPenalties", "Loan", 16), ("oneTimePenalties", "Loan", 17);
        </sql>
        <rollback>
            <dropColumn tableName="sections_questions" columnName="show_on_page"/>
            <sql endDelimiter=";">drop table information_order;</sql>
        </rollback>
    </changeSet>
    <changeSet id="MIFOS-5983_2" author="Lukasz Gasior" context="expansion">
        <sql endDelimiter=";">
            insert into information_order (name, additional_question_id, page, order_) values
                ("salutation", null, "CreateClient", 1), ("firstName", null, "CreateClient", 2), ("middleName", null, "CreateClient", 3),
                ("lastName", null, "CreateClient", 4), ("secondLastName", null, "CreateClient", 5), ("governmentId", null, "CreateClient", 6),
                ("dateOfBirth", null, "CreateClient", 7), ("gender", null, "CreateClient", 8), ("maritalStatus", null, "CreateClient", 9),
                ("numberOfChildren", null, "CreateClient", 10), ("citizenship", null, "CreateClient", 11), ("ethnicity", null, "CreateClient", 12),
                ("educationLevel", null, "CreateClient", 13), ("businessActivity", null, "CreateClient", 14), ("povertyStatus", null, "CreateClient", 15),
                ("handicapped", null, "CreateClient", 16), ("photo", null, "CreateClient", 17), ("spouseDetails", null, "CreateClient", 18),
                ("addressHeading", null, "CreateClient", 19), ("address1", null, "CreateClient", 20), ("address2", null, "CreateClient", 21), 
                ("address3", null, "CreateClient", 22), ("city", null, "CreateClient", 23), ("state", null, "CreateClient", 24), 
                ("country", null, "CreateClient", 25), ("postalCode", null, "CreateClient", 26), ("telephone", null, "CreateClient", 27);
        </sql>
        <rollback>
            <sql endDelimiter=";">delete from information_order where page = "CreateClient";</sql>
        </rollback>
    </changeSet>
    <changeSet id="MIFOS-5983_3" author="Lukasz Gasior" context="expansion">
        <sql endDelimiter=";">
            insert into information_order (name, page, order_) values ("amount", "CreateLoan", 1), ("interestRate", "CreateLoan", 2), 
                    ("numberOfInstallments", "CreateLoan", 3), ("disbursalDate", "CreateLoan", 4), ("modeOfPayment", "CreateLoan", 5), 
                    ("repaymentDay", "CreateLoan", 6), ("gracePeriod", "CreateLoan", 7), ("sourceOfFunds", "CreateLoan", 8), 
                    ("purposeOfLoan", "CreateLoan", 9), ("collateralType", "CreateLoan", 10), ("collateralNotes", "CreateLoan", 11), 
                    ("externalId", "CreateLoan", 12);
        </sql>
        <rollback>
            <sql endDelimiter=";">delete from information_order where page = "CreateLoan";</sql>
        </rollback>
    </changeSet>
    <changeSet id="MIFOS-5627" author="Lukasz Gasior" context="expansion">
        <sql endDelimiter=";">
            insert into information_order (name, page, order_) values ("guaranties", "Loan", 18);
        </sql>
        <rollback>
            <sql endDelimiter=";">delete from information_order where page = "Loan" and name = "guaranties";</sql>
        </rollback>
    </changeSet>
    <changeSet id="MIFOS-5739" author="Pawel Reise" context="expansion">
        <sql endDelimiter=";">
            create table file_info (
                file_info_id bigint auto_increment not null,
                name varchar(255) not null,
                content_type varchar(255) not null,
                size integer not null,
                description text,
                upload_date datetime not null,
                primary key(file_info_id)
            ) engine=innodb character set utf8;
            create table client_file (
                file_id bigint auto_increment not null,
                client_id integer,
                file_info bigint,
                primary key(file_id),
                foreign key(file_info)
                    references file_info(file_info_id),
                foreign key(client_id)
                    references customer(customer_id)
            ) engine=innodb character set utf8;
        </sql>
        <rollback>
            drop table client_file;
            drop table file_info;
        </rollback>
    </changeSet>
    <changeSet id="MIFOS-5739_2" author="Pawel Reise" context="expansion">
        <sql endDelimiter=";">
            create table loan_file (
                file_id bigint auto_increment not null,
                loan_id integer,
                file_info bigint,
                primary key(file_id),
                foreign key(file_info)
                    references file_info(file_info_id),
                foreign key(loan_id)
                    references account(account_id)
            ) engine=innodb character set utf8;
        </sql>
        <rollback>
            drop table loan_file;
        </rollback>
    </changeSet>
   <changeSet id="MIFOS-5712" author="Wojciech Szarmacher" context="expansion">
       <sql endDelimiter=";">
            insert into lookup_value(lookup_id,entity_id,lookup_name) values((select max(lv.lookup_id)+1 from
                lookup_value lv), 87, 'Permissions-CanModifyChartOfAccounts');
                
            insert into lookup_value_locale(locale_id,lookup_id,lookup_value) values
                (1,(select lookup_id from lookup_value where entity_id =87 and
                lookup_name='Permissions-CanModifyChartOfAccounts'),null); 
                
            insert into activity(activity_id,parent_id, activity_name_lookup_id, DESCRIPTION_lookup_id) 
                values(300,203,(select lookup_id from lookup_value where entity_id =87 and
                lookup_name='Permissions-CanModifyChartOfAccounts'),
                (select lookup_id from lookup_value where entity_id =87 and
                lookup_name='Permissions-CanModifyChartOfAccounts'));
                
            insert into roles_activity(activity_id, role_id) values(300, 1);          
       </sql>
       <rollback>
           <sql endDelimiter=";">
                delete from roles_activity where activity_id = 300 or activity_id in (select activity_id from activity where parent_id = 300);
                
                delete from activity where parent_id = 300 or activity_id = 300;
                
                delete from lookup_value_locale where lookup_id =
                    (select lookup_id from lookup_value
                    where lookup_name='Permissions-CanModifyChartOfAccounts');

                delete from lookup_value where entity_id = 87 and lookup_name =
                    'Permissions-CanModifyChartOfAccounts';
           </sql>
       </rollback>
   </changeSet>
   <changeSet id="MIFOS-5626" author="Krzysztof Kaczmarczyk" context="expansion">
       <sql endDelimiter=";">
            insert into lookup_value(lookup_id,entity_id,lookup_name) values((select max(lv.lookup_id)+1 from
                lookup_value lv), 87, 'Can unblacklist a Client');
                
            insert into lookup_value_locale(locale_id,lookup_id,lookup_value) values
                (1,(select lookup_id from lookup_value where entity_id =87 and
                lookup_name='Can unblacklist a Client'),null); 
                
            insert into activity(activity_id,parent_id, activity_name_lookup_id, DESCRIPTION_lookup_id) 
                values(301,34,(select lookup_id from lookup_value where entity_id =87 and
                lookup_name='Can unblacklist a Client'),
                (select lookup_id from lookup_value where entity_id =87 and
                lookup_name='Can unblacklist a Client'));
                
            insert into roles_activity(activity_id, role_id) values(301, 1);          
       </sql>
       <rollback>
           <sql endDelimiter=";">
                delete from roles_activity where activity_id = 301 or activity_id in (select activity_id from activity where parent_id = 301);
                
                delete from activity where parent_id = 301 or activity_id = 301;
                
                delete from lookup_value_locale where lookup_id =
                    (select lookup_id from lookup_value
                    where lookup_name='Can unblacklist a Client');

                delete from lookup_value where entity_id = 87 and lookup_name =
                    'Can unblacklist a Client';
           </sql>
       </rollback>
   </changeSet>
    <changeSet id="MIFOSFINANACC" author="Hugo Technologies"
		context="expansion">
		<sql endDelimiter=";">

			alter table acc_glmaster add stage INT default
			0;

			alter table acc_glmaster add updated_date timestamp default
			current_timestamp;

			alter table acc_glmaster add member_id varchar(20)
			default null;

			alter table acc_glmaster add audit varchar(10) default
			'no';

			alter table acc_glmaster add audit_comments varchar(225);

			create table acc_process_update(pud_id smallint(10) PRIMARY KEY AUTO_INCREMENT,branch_globaloffice_num varchar(100),last_update_date date);

			create table `coa_branch` (`coa_id` integer not null auto_increment,
            `glcode_value` varchar(50) default null,
            `global_office_num` varchar(50) default null,
             `coa_name` varchar(42) default null,
             PRIMARY KEY (`coa_id`)
               );
			   insert  into
			lookup_value(lookup_id,entity_id, lookup_name) values ((SELECT
			MAX(lv.lookup_id)+1 FROM
			lookup_value lv),87,
			'Permissions-SingleGeneralLedgerSave');

			insert into
			lookup_value_locale(locale_id, lookup_id, lookup_value) values
			(1,
			(select lookup_id from lookup_value where
			lookup_name='Permissions-SingleGeneralLedgerSave'), NULL);


			insert into
			activity(activity_id,
			parent_id,activity_name_lookup_id,description_lookup_id) values
			(302,
			113,
			(select lookup_id from
			lookup_value where entity_id = 87 AND
			lookup_name='Permissions-SingleGeneralLedgerSave'),
			(select
			lookup_id from
			lookup_value where entity_id = 87 AND
			lookup_name='Permissions-SingleGeneralLedgerSave'));


			insert into
			roles_activity(activity_id, role_id) values (302, 1);

			insert into
			lookup_value(lookup_id,entity_id, lookup_name) values ((SELECT
			MAX(lv.lookup_id)+1 FROM
			lookup_value lv),87,
			'Permissions-JournalVoucherSave');

			insert into
			lookup_value_locale(locale_id, lookup_id, lookup_value) values
			(1,
			(select lookup_id from lookup_value where
			lookup_name='Permissions-JournalVoucherSave'), NULL);


			insert into
			activity(activity_id,
			parent_id,activity_name_lookup_id,description_lookup_id) values
			(303,
			113,
			(select lookup_id from
			lookup_value where entity_id = 87 AND
			lookup_name='Permissions-JournalVoucherSave'),
			(select
			lookup_id from
			lookup_value where entity_id = 87 AND
			lookup_name='Permissions-JournalVoucherSave'));


			insert into
			roles_activity(activity_id, role_id) values (303, 1);



			insert into
			lookup_value(lookup_id,entity_id, lookup_name) values ((SELECT
			MAX(lv.lookup_id)+1 FROM
			lookup_value lv),87,
			'Permissions-ViewStageTransactions');
			insert into
			lookup_value_locale(locale_id, lookup_id, lookup_value) values
			(1,
			(select lookup_id from lookup_value where
			lookup_name='Permissions-ViewStageTransactions'), NULL);
			insert into
			activity(activity_id,
			parent_id,activity_name_lookup_id,description_lookup_id) values
			(304,
			113,
			(select lookup_id from
			lookup_value where entity_id = 87 AND
			lookup_name='Permissions-ViewStageTransactions'),
			(select
			lookup_id
			from lookup_value where entity_id = 87 AND
			lookup_name='Permissions-ViewStageTransactions'));
			insert into
			roles_activity(activity_id, role_id) values (304, 1);

			insert into
			lookup_value(lookup_id,entity_id, lookup_name) values ((SELECT
			MAX(lv.lookup_id)+1 FROM
			lookup_value lv),87,
			'Permissions-InterOfficeTransfers');
			insert into
			lookup_value_locale(locale_id, lookup_id, lookup_value) values
			(1,
			(select lookup_id from lookup_value where
			lookup_name='Permissions-InterOfficeTransfers'), NULL);
			insert into
			activity(activity_id,
			parent_id,activity_name_lookup_id,description_lookup_id) values
			(305,
			113,
			(select lookup_id from
			lookup_value where entity_id = 87 AND
			lookup_name='Permissions-InterOfficeTransfers'),
			(select
			lookup_id from
			lookup_value where entity_id = 87 AND
			lookup_name='Permissions-InterOfficeTransfers'));
			insert into
			roles_activity(activity_id, role_id) values (305, 1);

			insert into
			lookup_value(lookup_id,entity_id, lookup_name) values ((SELECT
			MAX(lv.lookup_id)+1 FROM
			lookup_value lv),87,
			'Permissions-ApproveTransactions');
			insert into
			lookup_value_locale(locale_id, lookup_id, lookup_value) values
			(1,
			(select lookup_id from lookup_value where
			lookup_name='Permissions-ApproveTransactions'), NULL);
			insert into
			activity(activity_id,
			parent_id,activity_name_lookup_id,description_lookup_id) values
			(306,
			113,
			(select lookup_id from
			lookup_value where entity_id = 87 AND
			lookup_name='Permissions-ApproveTransactions'),
			(select
			lookup_id from
			lookup_value where entity_id = 87 AND
			lookup_name='Permissions-ApproveTransactions'));
			insert into
			roles_activity(activity_id, role_id) values (306, 1);

			insert into
			lookup_value(lookup_id,entity_id, lookup_name) values ((SELECT
			MAX(lv.lookup_id)+1 FROM
			lookup_value lv),87,
			'Permissions-AuditTransactions');
			insert into
			lookup_value_locale(locale_id, lookup_id, lookup_value) values
			(1,
			(select lookup_id from lookup_value where
			lookup_name='Permissions-AuditTransactions'), NULL);
			insert into
			activity(activity_id,
			parent_id,activity_name_lookup_id,description_lookup_id) values
			(307,
			113,
			(select lookup_id from
			lookup_value where entity_id = 87 AND
			lookup_name='Permissions-AuditTransactions'),
			(select
			lookup_id from
			lookup_value where entity_id = 87 AND
			lookup_name='Permissions-AuditTransactions'));
			insert into
			roles_activity(activity_id, role_id) values (307, 1);

			insert into
			lookup_value(lookup_id,entity_id, lookup_name) values ((SELECT
			MAX(lv.lookup_id)+1 FROM
			lookup_value lv),87,
			'Permissions-CoaBranchMapping');
			insert into
			lookup_value_locale(locale_id, lookup_id, lookup_value) values
			(1,
			(select lookup_id from lookup_value where
			lookup_name='Permissions-CoaBranchMapping'), NULL);
			insert into
			activity(activity_id,
			parent_id,activity_name_lookup_id,description_lookup_id) values
			(308,
			113,
			(select lookup_id from
			lookup_value where entity_id = 87 AND
			lookup_name='Permissions-CoaBranchMapping'),
			(select
			lookup_id from
			lookup_value where entity_id = 87 AND
			lookup_name='Permissions-CoaBranchMapping'));
			insert into
			roles_activity(activity_id, role_id) values (308, 1);


                         insert into
			lookup_value(lookup_id,entity_id, lookup_name) values ((SELECT
			MAX(lv.lookup_id)+1 FROM
			lookup_value lv),87,
			'Permissions-BranchVoucherEntry');
			insert into
			lookup_value_locale(locale_id, lookup_id, lookup_value) values
			(1,
			(select lookup_id from lookup_value where
			lookup_name='Permissions-BranchVoucherEntry'), NULL);
			insert into
			activity(activity_id,
			parent_id,activity_name_lookup_id,description_lookup_id) values
			(309,
			113,
			(select lookup_id from
			lookup_value where entity_id = 87 AND
			lookup_name='Permissions-BranchVoucherEntry'),
			(select
			lookup_id from
			lookup_value where entity_id = 87 AND
			lookup_name='Permissions-BranchVoucherEntry'));
			insert into
			roles_activity(activity_id, role_id) values (309, 1);

                         insert into
			lookup_value(lookup_id,entity_id, lookup_name) values ((SELECT
			MAX(lv.lookup_id)+1 FROM
			lookup_value lv),87,
			'Permissions-ConsolidatedTransaction');
			insert into
			lookup_value_locale(locale_id, lookup_id, lookup_value) values
			(1,
			(select lookup_id from lookup_value where
			lookup_name='Permissions-ConsolidatedTransaction'), NULL);
			insert into
			activity(activity_id,
			parent_id,activity_name_lookup_id,description_lookup_id) values
			(310,
			113,
			(select lookup_id from
			lookup_value where entity_id = 87 AND
			lookup_name='Permissions-ConsolidatedTransaction'),
			(select
			lookup_id from
			lookup_value where entity_id = 87 AND
			lookup_name='Permissions-ConsolidatedTransaction'));
			insert into
			roles_activity(activity_id, role_id) values (310, 1);

			insert into
			lookup_value(lookup_id,entity_id, lookup_name) values ((SELECT
			MAX(lv.lookup_id)+1 FROM
			lookup_value lv),87,
			'Permissions-MultipleGeneralLedgerAction');
			insert into
			lookup_value_locale(locale_id, lookup_id, lookup_value) values
			(1,
			(select lookup_id from lookup_value where
			lookup_name='Permissions-MultipleGeneralLedgerAction'), NULL);
			insert into
			activity(activity_id,
			parent_id,activity_name_lookup_id,description_lookup_id) values
			(311,
			113,
			(select lookup_id from
			lookup_value where entity_id = 87 AND
			lookup_name='Permissions-MultipleGeneralLedgerAction'),
			(select
			lookup_id from
			lookup_value where entity_id = 87 AND
			lookup_name='Permissions-MultipleGeneralLedgerAction'));
			insert into
			roles_activity(activity_id, role_id) values (311, 1);

			insert into
			lookup_value(lookup_id,entity_id, lookup_name) values ((SELECT
			MAX(lv.lookup_id)+1 FROM
			lookup_value lv),87,
			'Permissions-MultipleGeneralLedgerActionSave');
			insert into
			lookup_value_locale(locale_id, lookup_id, lookup_value) values
			(1,
			(select lookup_id from lookup_value where
			lookup_name='Permissions-MultipleGeneralLedgerActionSave'), NULL);
			insert into
			activity(activity_id,
			parent_id,activity_name_lookup_id,description_lookup_id) values
			(312,
			113,
			(select lookup_id from
			lookup_value where entity_id = 87 AND
			lookup_name='Permissions-MultipleGeneralLedgerActionSave'),
			(select
			lookup_id from
			lookup_value where entity_id = 87 AND
			lookup_name='Permissions-MultipleGeneralLedgerActionSave'));
			insert into
			roles_activity(activity_id, role_id) values (312, 1);

			</sql>
		<rollback>
			<sql endDelimiter=";">

           Drop table  acc_process_update;
           Drop  table  coa_branch;
           
				DELETE FROM lookup_value_locale WHERE lookup_id =(SELECT lookup_id
				from
				lookup_value WHERE lookup_name='Permissions-SingleGeneralLedgerSave');

				DELETE FROM roles_activity WHERE activity_id= 302;

				DELETE FROM
				activity WHERE activity_id = 302;

				DELETE FROM lookup_value WHERE
				entity_id = 87 AND lookup_name ='Permissions-SingleGeneralLedgerSave';

				DELETE FROM lookup_value_locale WHERE lookup_id =(SELECT lookup_id
				from
				lookup_value WHERE
				lookup_name='Permissions-JournalVoucherSave');

				DELETE FROM
				roles_activity WHERE activity_id= 303;

				DELETE FROM activity WHERE
				activity_id = 303;

				DELETE FROM lookup_value WHERE entity_id = 87 AND
				lookup_name ='Permissions-JournalVoucherSave';




				DELETE FROM
				lookup_value_locale WHERE lookup_id =(SELECT lookup_id from
				lookup_value WHERE lookup_name='Permissions-ViewStageTransactions');

				DELETE
				FROM roles_activity WHERE activity_id= 304;

				DELETE FROM activity
				WHERE activity_id = 304;

				DELETE FROM lookup_value WHERE entity_id =
				87 AND lookup_name ='Permissions-ViewStageTransactions';

				DELETE FROM
				lookup_value_locale WHERE lookup_id =(SELECT lookup_id from
				lookup_value WHERE lookup_name='Permissions-InterOfficeTransfers');

				DELETE
				FROM roles_activity WHERE activity_id= 305;

				DELETE FROM activity
				WHERE activity_id = 305;

				DELETE FROM lookup_value WHERE entity_id =
				87 AND lookup_name ='Permissions-InterOfficeTransfers';

				DELETE FROM
				lookup_value_locale WHERE lookup_id =(SELECT lookup_id from
				lookup_value WHERE lookup_name='Permissions-ApproveTransactions');

				DELETE
				FROM roles_activity WHERE activity_id= 306;

				DELETE FROM activity
				WHERE activity_id = 306;

				DELETE FROM lookup_value WHERE entity_id =
				87 AND lookup_name ='Permissions-ApproveTransactions';

				DELETE FROM
				lookup_value_locale WHERE lookup_id =(SELECT lookup_id from
				lookup_value WHERE lookup_name='Permissions-AuditTransactions');

				DELETE
				FROM roles_activity WHERE activity_id= 307;

				DELETE FROM activity
				WHERE activity_id = 307;

				DELETE FROM lookup_value WHERE entity_id =
				87 AND lookup_name ='Permissions-AuditTransactions';

				 DELETE FROM
				lookup_value_locale WHERE lookup_id =(SELECT lookup_id from
				lookup_value WHERE lookup_name='Permissions-CoaBranchMapping');

				DELETE
				FROM roles_activity WHERE activity_id= 308;

				DELETE FROM activity
				WHERE activity_id = 308;

				DELETE FROM lookup_value WHERE entity_id =
				87 AND lookup_name ='Permissions-CoaBranchMapping';


                            DELETE FROM
				lookup_value_locale WHERE lookup_id =(SELECT lookup_id from
				lookup_value WHERE lookup_name='Permissions-BranchVoucherEntry');

				DELETE
				FROM roles_activity WHERE activity_id= 309;

				DELETE FROM activity
				WHERE activity_id = 309;

				DELETE FROM lookup_value WHERE entity_id =
				87 AND lookup_name ='Permissions-BranchVoucherEntry';



                           DELETE FROM
				lookup_value_locale WHERE lookup_id =(SELECT lookup_id from
				lookup_value WHERE lookup_name='Permissions-ConsolidatedTransaction');

				DELETE
				FROM roles_activity WHERE activity_id= 310;

				DELETE FROM activity
				WHERE activity_id = 310;

				DELETE FROM lookup_value WHERE entity_id =
				87 AND lookup_name ='Permissions-ConsolidatedTransaction';

				 DELETE FROM
				lookup_value_locale WHERE lookup_id =(SELECT lookup_id from
				lookup_value WHERE lookup_name='Permissions-MultipleGeneralLedgerAction');

				DELETE
				FROM roles_activity WHERE activity_id= 311;

				DELETE FROM activity
				WHERE activity_id = 311;

				DELETE FROM lookup_value WHERE entity_id =
				87 AND lookup_name ='Permissions-MultipleGeneralLedgerAction';


                                 DELETE FROM
				lookup_value_locale WHERE lookup_id =(SELECT lookup_id from
				lookup_value WHERE lookup_name='Permissions-MultipleGeneralLedgerActionSave');

				DELETE
				FROM roles_activity WHERE activity_id= 312;

				DELETE FROM activity
				WHERE activity_id = 312;

				DELETE FROM lookup_value WHERE entity_id =
				87 AND lookup_name ='Permissions-MultipleGeneralLedgerActionSave';

			 </sql>
       </rollback>
   </changeSet>
   <changeSet id="MIFOS-5992" author="Pawel Reise" context="expansion">
       <sql endDelimiter=";">
            insert into lookup_value(lookup_id,entity_id,lookup_name) values((select max(lv.lookup_id)+1 from
                lookup_value lv), 87, 'Can change Mifos logo');
                
            insert into lookup_value_locale(locale_id,lookup_id,lookup_value) values
                (1,(select lookup_id from lookup_value where entity_id =87 and
                lookup_name='Can change Mifos logo'),null); 
                
            insert into activity(activity_id,parent_id, activity_name_lookup_id, DESCRIPTION_lookup_id) 
                values(313,203,(select lookup_id from lookup_value where entity_id =87 and
                lookup_name='Can change Mifos logo'),
                (select lookup_id from lookup_value where entity_id =87 and
                lookup_name='Can change Mifos logo'));
                
            insert into roles_activity(activity_id, role_id) values(313, 1);          
       </sql>
       <rollback>
           <sql endDelimiter=";">
                delete from roles_activity where activity_id = 313 or activity_id in (select activity_id from activity where parent_id = 313);
                
                delete from activity where parent_id = 313 or activity_id = 313;
                
                delete from lookup_value_locale where lookup_id =
                    (select lookup_id from lookup_value
                    where lookup_name='Can change Mifos logo');

                delete from lookup_value where entity_id = 87 and lookup_name =
                    'Can change Mifos logo';
           </sql>
       </rollback>
   </changeSet>
   
   <changeSet id="MIFOS-5627" author="Krzysztof Kaczmarczyk" context="expansion">
        <sql endDelimiter=";">
            create table guaranty (
                guaranty_id integer auto_increment not null,
                guarantor_id integer not null,
                loan_id integer not null,
                state boolean not null,
                primary key(guaranty_id),
                foreign key(guarantor_id)
                    references customer(customer_id),
                foreign key(loan_id)
                    references account(account_id)
            ) engine=innodb character set utf8;
        </sql>
        <rollback>
            drop table guaranty;
        </rollback>
    </changeSet>
    <changeSet id="MIFOS-5627_2" author="Krzysztof Kaczmarczyk" context="expansion">
       <sql endDelimiter=";">
            insert into lookup_value(lookup_id,entity_id,lookup_name) values((select max(lv.lookup_id)+1 from
                lookup_value lv), 87, 'Can apply a guaranty');
                
            insert into lookup_value_locale(locale_id,lookup_id,lookup_value) values
                (1,(select lookup_id from lookup_value where entity_id =87 and
                lookup_name='Can apply a guaranty'),null);
                
            insert into activity(activity_id,parent_id, activity_name_lookup_id, DESCRIPTION_lookup_id)
                values(314,100,(select lookup_id from lookup_value where entity_id =87 and
                lookup_name='Can apply a guaranty'),
                (select lookup_id from lookup_value where entity_id =87 and
                lookup_name='Can apply a guaranty'));
                
            insert into roles_activity(activity_id, role_id) values(314, 1);
       </sql>
       <rollback>
           <sql endDelimiter=";">
                delete from roles_activity where activity_id = 314 or activity_id in (select activity_id from activity where parent_id = 314);
                
                delete from activity where parent_id = 314 or activity_id = 314;
                
                delete from lookup_value_locale where lookup_id =
                    (select lookup_id from lookup_value
                    where lookup_name='Can apply a guaranty');

                delete from lookup_value where entity_id = 87 and lookup_name =
                    'Can apply a guaranty';
           </sql>
       </rollback>
   </changeSet>
   <changeSet id="MIFOS-5627_3" author="Lukas Gasior" context="expansion">
       <sql endDelimiter=";">
            insert into lookup_value(lookup_id,entity_id,lookup_name) values((select max(lv.lookup_id)+1 from
                lookup_value lv), 87, 'Can remove guaranty');
                
            insert into lookup_value_locale(locale_id,lookup_id,lookup_value) values
                (1,(select lookup_id from lookup_value where entity_id =87 and
                lookup_name='Can remove guaranty'),null);
                
            insert into activity(activity_id,parent_id, activity_name_lookup_id, DESCRIPTION_lookup_id)
                values(315,100,(select lookup_id from lookup_value where entity_id =87 and
                lookup_name='Can remove guaranty'),
                (select lookup_id from lookup_value where entity_id =87 and
                lookup_name='Can remove guaranty'));
                
            insert into roles_activity(activity_id, role_id) values(315, 1);
       </sql>
       <rollback>
           <sql endDelimiter=";">
                delete from roles_activity where activity_id = 315 or activity_id in (select activity_id from activity where parent_id = 315);
                
                delete from activity where parent_id = 315 or activity_id = 315;
                
                delete from lookup_value_locale where lookup_id =
                    (select lookup_id from lookup_value
                    where lookup_name='Can remove guaranty');

                delete from lookup_value where entity_id = 87 and lookup_name =
                    'Can remove guaranty';
           </sql>
       </rollback>
   </changeSet>

   <changeSet id="MIFOS-6034" author="Lech Rozanski" context="expansion">
   <sql endDelimiter=";">
	   insert into lookup_value(lookup_id,entity_id,lookup_name) values((select max(lv.lookup_id)+1 from
	   lookup_value lv), 87, 'Can edit question group responses');

	   insert into lookup_value_locale(locale_id,lookup_id,lookup_value) values
	   (1,(select lookup_id from lookup_value where entity_id =87 and
	   lookup_name='Can edit question group responses'),null); 

	   insert into activity(activity_id,parent_id, activity_name_lookup_id, DESCRIPTION_lookup_id) 
	   values(316,203,(select lookup_id from lookup_value where entity_id =87 and
	   lookup_name='Can edit question group responses'),
	   (select lookup_id from lookup_value where entity_id =87 and
	   lookup_name='Can edit question group responses'));

	   insert into roles_activity(activity_id, role_id) values(316, 1);          
   </sql>
   <rollback>
      <sql endDelimiter=";">
	   delete from roles_activity where activity_id = 316 or activity_id in (select activity_id from activity where parent_id = 316);

	   delete from activity where parent_id = 316 or activity_id = 316;

	   delete from lookup_value_locale where lookup_id =
		   (select lookup_id from lookup_value
		   where lookup_name='Can edit question group responses');

	   delete from lookup_value where entity_id = 87 and lookup_name =
		   'Can edit question group responses';
      </sql>
   </rollback>
   </changeSet>
   
   <changeSet id="MIFOS-6020" author="Pawel Reise" context="expansion">
   <validCheckSum>3:2495a4c6db1be74e7747a846addf1915</validCheckSum>
   <sql endDelimiter=";">
       alter table account_status_change_history
            add column note_id integer,
            add constraint `note_fk` foreign key (note_id)
                references account_notes (account_notes_id);
   </sql>
   <rollback>
      <sql endDelimiter=";">
           alter table account_status_change_history
                drop foreign key `note_fk`,
                drop column note_id;
      </sql>
   </rollback>
   </changeSet>
   <changeSet id="MIFOS-5984" author="Krzysztof Kaczmarczyk" context="expansion">
        <validCheckSum>3:a5e27a7b08513e592a0f6f7394e63c87</validCheckSum>
        <validCheckSum>3:ac24dcf5de5a7426fbe6d27053dfcdbc</validCheckSum>
        <sql endDelimiter=";">
            DROP TABLE IF EXISTS section_link;
            DROP TABLE IF EXISTS section_question_link;
            DROP TABLE IF EXISTS question_group_link;
            
            SELECT @lookupEntityId := entity_id from lookup_entity where entity_name = "ConditionType";
                DELETE FROM lookup_value WHERE entity_id = @lookupEntityId;
                DELETE FROM lookup_entity WHERE entity_id = @lookupEntityId;
            
            CREATE TABLE question_group_link (
                id bigint auto_increment NOT NULL,
                condition_type_lookup_id int NOT NULL,
                value varchar(255) NOT NULL,
                additional_value varchar(255),
                source_section_question_id int NOT NULL,
                primary key(id),
                foreign key(source_section_question_id)
                    references sections_questions(id),
                foreign key(condition_type_lookup_id)
                    references lookup_value(lookup_id)
            ) engine=innodb character set utf8;
            
            CREATE TABLE section_question_link (
                id bigint auto_increment NOT NULL,
                question_group_link_id bigint NOT NULL,
                affected_section_question_id int NOT NULL,
                primary key(id),
                foreign key(question_group_link_id)
                    references question_group_link(id),
                foreign key(affected_section_question_id)
                    references sections_questions(id)
            ) engine=innodb character set utf8;
            
            CREATE TABLE section_link (
                id bigint auto_increment NOT NULL,
                question_group_link_id bigint NOT NULL,
                affected_section_id int NOT NULL,
                primary key(id),
                foreign key(question_group_link_id)
                    references question_group_link(id),
                foreign key(affected_section_id)
                    references sections(id)
            ) engine=innodb character set utf8;
            
            SELECT @lookupEntityId := max(entity_id)+1 from lookup_entity;
            
            INSERT INTO lookup_entity (entity_id, entity_name, description) values 
                (@lookupEntityId, "ConditionType", "Question group link condition type");
                
            INSERT INTO lookup_value (entity_id, lookup_name) values 
                (@lookupEntityId, "QuestionGroupLink.equals"), 
                (@lookupEntityId, "QuestionGroupLink.notEquals"),
                (@lookupEntityId, "QuestionGroupLink.greater"),
                (@lookupEntityId, "QuestionGroupLink.smaller"),
                (@lookupEntityId, "QuestionGroupLink.range"),
                (@lookupEntityId, "QuestionGroupLink.dateRange"),
                (@lookupEntityId, "QuestionGroupLink.before"),
                (@lookupEntityId, "QuestionGroupLink.after");
        </sql>
        <rollback>
            <sql endDelimiter=";">
                DROP TABLE IF EXISTS section_link;
                DROP TABLE IF EXISTS section_question_link;
                DROP TABLE IF EXISTS question_group_link;
                SELECT @lookupEntityId := entity_id from lookup_entity where entity_name = "ConditionType";
                DELETE FROM lookup_value WHERE entity_id = @lookupEntityId;
                DELETE FROM lookup_entity WHERE entity_id = @lookupEntityId;
            </sql>
        </rollback>
    </changeSet>
    
    <changeSet id="MIFOS-6024" author="Pawel Reise" context="expansion">
        <sql endDelimiter=";">
            /* FINANCIAL ACCOUNTING REPORTS CATEGORY */
            
            insert into lookup_value(lookup_id,entity_id,lookup_name) values((select max(lv.lookup_id)+1 from
                lookup_value lv), 87, 'Permissions-FinancialAccounting');
            
            insert into lookup_value_locale(locale_id,lookup_id,lookup_value) values
                (1,(select lookup_id from lookup_value where entity_id =87 and
                lookup_name='Permissions-FinancialAccounting'),'Financial Accounting');
            
            insert into activity(activity_id,parent_id, activity_name_lookup_id, DESCRIPTION_lookup_id) 
                values(317,141,(select lookup_id from lookup_value where entity_id =87 and
                    lookup_name='Permissions-FinancialAccounting'),
                    (select lookup_id from lookup_value where entity_id =87 and
                    lookup_name='Permissions-FinancialAccounting'));
            
            set @FINANCIALACC_CATEGORY_ID = (select max(report_category_id)+1 from report_category);
            
            insert into report_category(report_category_id, report_category_value, activity_id) 
                values (@FINANCIALACC_CATEGORY_ID, 'Financial Accounting', 317);
            
            insert into roles_activity(activity_id, role_id) values(317, 1);
            
            /* TRANSACTION DETAILS REPORT */
            
            insert into lookup_value(lookup_id,entity_id,lookup_name) values((select max(lv.lookup_id)+1 from
                lookup_value lv), 87, 'Permissions-CanViewTransactionDetailsReport');
            
            insert into lookup_value_locale(locale_id,lookup_id,lookup_value) values
                (1,(select lookup_id from lookup_value where entity_id =87 and
                lookup_name='Permissions-CanViewTransactionDetailsReport'),'Can view Transaction Details report');
            
            insert into activity(activity_id,parent_id, activity_name_lookup_id, DESCRIPTION_lookup_id) 
                values(318,317,(select lookup_id from lookup_value where entity_id =87 and
                    lookup_name='Permissions-CanViewTransactionDetailsReport'),
                    (select lookup_id from lookup_value where entity_id =87 and
                    lookup_name='Permissions-CanViewTransactionDetailsReport'));
            
            insert into roles_activity(activity_id, role_id) values(318, 1);
            
            insert into report(report_id, report_category_id, report_name, report_identifier, activity_id, report_active)
                values((select max(rid.report_id)+1 from report rid), 
                    (select rci.report_category_id from report_category rci where rci.report_category_value='Financial Accounting'), 
                    'Transaction Details', 'transaction_details', 318, 1);
            
            insert into report_jasper_map(report_id, report_name, report_identifier, report_jasper) 
                values((select report_id from report where report_name='Transaction Details'), 
                    'Transaction Details', 'transaction_details', 'TransactionDetails.prpt');
            
            
            /* FINANCIAL TRANSACTION SUMMARY */
            
            insert into lookup_value(lookup_id,entity_id,lookup_name) values((select max(lv.lookup_id)+1 from
                lookup_value lv), 87, 'Permissions-CanViewFinancialTransactionSummaryReport');
            
            insert into lookup_value_locale(locale_id,lookup_id,lookup_value) values
                (1,(select lookup_id from lookup_value where entity_id =87 and
                lookup_name='Permissions-CanViewFinancialTransactionSummaryReport'),'Can view Financial Transaction Summary report');
            
            insert into activity(activity_id,parent_id, activity_name_lookup_id, DESCRIPTION_lookup_id) 
                values(319,317,(select lookup_id from lookup_value where entity_id =87 and
                    lookup_name='Permissions-CanViewFinancialTransactionSummaryReport'),
                    (select lookup_id from lookup_value where entity_id =87 and
                    lookup_name='Permissions-CanViewFinancialTransactionSummaryReport'));
            
            insert into roles_activity(activity_id, role_id) values(319, 1);
            
            insert into report(report_id, report_category_id, report_name, report_identifier, activity_id, report_active)
                values((select max(rid.report_id)+1 from report rid), 
                    (select rci.report_category_id from report_category rci where rci.report_category_value='Financial Accounting'), 
                    'Financial Transaction Summary', 'financial_transaction_summary', 319, 1);
            
            insert into report_jasper_map(report_id, report_name, report_identifier, report_jasper) 
                values((select report_id from report where report_name='Financial Transaction Summary'), 
                    'Transaction Details', 'financial_transaction_summary', 'FinancialTransactionSummary.prpt');
            
            /* GENERAL LEDGER REPORT */
            
            insert into lookup_value(lookup_id,entity_id,lookup_name) values((select max(lv.lookup_id)+1 from
                lookup_value lv), 87, 'Permissions-CanViewGeneralLedgerReport');
            
            insert into lookup_value_locale(locale_id,lookup_id,lookup_value) values
                (1,(select lookup_id from lookup_value where entity_id =87 and
                lookup_name='Permissions-CanViewGeneralLedgerReport'),'Can view General Ledger report');
            
            insert into activity(activity_id,parent_id, activity_name_lookup_id, DESCRIPTION_lookup_id) 
                values(320,317,(select lookup_id from lookup_value where entity_id =87 and
                    lookup_name='Permissions-CanViewGeneralLedgerReport'),
                    (select lookup_id from lookup_value where entity_id =87 and
                    lookup_name='Permissions-CanViewGeneralLedgerReport'));
            
            insert into roles_activity(activity_id, role_id) values(320, 1);
            
            insert into report(report_id, report_category_id, report_name, report_identifier, activity_id, report_active)
                values((select max(rid.report_id)+1 from report rid), 
                    (select rci.report_category_id from report_category rci where rci.report_category_value='Financial Accounting'), 
                    'General Ledger', 'general_ledger', 320, 1);
            
            insert into report_jasper_map(report_id, report_name, report_identifier, report_jasper) 
                values((select report_id from report where report_name='General Ledger'), 
                    'General Ledger', 'general_ledger', 'GeneralLedger.prpt');
            
            
            /* TRIAL BALANCE REPORT */
            
            insert into lookup_value(lookup_id,entity_id,lookup_name) values((select max(lv.lookup_id)+1 from
                lookup_value lv), 87, 'Permissions-CanViewTrialBalanceReport');
            
            insert into lookup_value_locale(locale_id,lookup_id,lookup_value) values
                (1,(select lookup_id from lookup_value where entity_id =87 and
                lookup_name='Permissions-CanViewTrialBalanceReport'),'Can view Trial Balance report');
            
            insert into activity(activity_id,parent_id, activity_name_lookup_id, DESCRIPTION_lookup_id) 
                values(321,317,(select lookup_id from lookup_value where entity_id =87 and
                    lookup_name='Permissions-CanViewTrialBalanceReport'),
                    (select lookup_id from lookup_value where entity_id =87 and
                    lookup_name='Permissions-CanViewTrialBalanceReport'));
            
            insert into roles_activity(activity_id, role_id) values(321, 1);
            
            insert into report(report_id, report_category_id, report_name, report_identifier, activity_id, report_active)
                values((select max(rid.report_id)+1 from report rid), 
                    (select rci.report_category_id from report_category rci where rci.report_category_value='Financial Accounting'), 
                    'Trial Balance', 'trial_balance', 321, 1);
            
            insert into report_jasper_map(report_id, report_name, report_identifier, report_jasper) 
                values((select report_id from report where report_name='Trial Balance'), 
                    'Trial Balance', 'trial_balance', 'TrialBalance.prpt');
            
            /* TRIAL BALANCE V2 REPORT */
            
            insert into lookup_value(lookup_id,entity_id,lookup_name) values((select max(lv.lookup_id)+1 from
                lookup_value lv), 87, 'Permissions-CanViewTrialBalanceV2Report');
            
            insert into lookup_value_locale(locale_id,lookup_id,lookup_value) values
                (1,(select lookup_id from lookup_value where entity_id =87 and
                lookup_name='Permissions-CanViewTrialBalanceV2Report'),'Can view Trial Balance V2 report');
            
            insert into activity(activity_id,parent_id, activity_name_lookup_id, DESCRIPTION_lookup_id) 
                values(322,317,(select lookup_id from lookup_value where entity_id =87 and
                    lookup_name='Permissions-CanViewTrialBalanceV2Report'),
                    (select lookup_id from lookup_value where entity_id =87 and
                    lookup_name='Permissions-CanViewTrialBalanceV2Report'));
            
            insert into roles_activity(activity_id, role_id) values(322, 1);
            
            insert into report(report_id, report_category_id, report_name, report_identifier, activity_id, report_active)
                values((select max(rid.report_id)+1 from report rid), 
                    (select rci.report_category_id from report_category rci where rci.report_category_value='Financial Accounting'), 
                    'Trial Balance V2', 'trial_balance_v2', 322, 1);
            
            insert into report_jasper_map(report_id, report_name, report_identifier, report_jasper) 
                values((select report_id from report where report_name='Trial Balance V2'), 
                    'Trial Balance V2', 'trial_balance_v2', 'TrialBalanceV2.prpt');
            
            /* RECEIPTS AND PAYMENTS REPORT */
            
            insert into lookup_value(lookup_id,entity_id,lookup_name) values((select max(lv.lookup_id)+1 from
                lookup_value lv), 87, 'Permissions-CanViewReceiptsAndPaymentsReport');
            
            insert into lookup_value_locale(locale_id,lookup_id,lookup_value) values
                (1,(select lookup_id from lookup_value where entity_id =87 and
                lookup_name='Permissions-CanViewReceiptsAndPaymentsReport'),'Can view Receipts And Payments report');
            
            insert into activity(activity_id,parent_id, activity_name_lookup_id, DESCRIPTION_lookup_id) 
                values(323,317,(select lookup_id from lookup_value where entity_id =87 and
                    lookup_name='Permissions-CanViewReceiptsAndPaymentsReport'),
                    (select lookup_id from lookup_value where entity_id =87 and
                    lookup_name='Permissions-CanViewReceiptsAndPaymentsReport'));
            
            insert into roles_activity(activity_id, role_id) values(323, 1);
            
            insert into report(report_id, report_category_id, report_name, report_identifier, activity_id, report_active)
                values((select max(rid.report_id)+1 from report rid), 
                    (select rci.report_category_id from report_category rci where rci.report_category_value='Financial Accounting'), 
                    'Receipts And Payments', 'receipts_and_payments', 323, 1);
            
            insert into report_jasper_map(report_id, report_name, report_identifier, report_jasper) 
                values((select report_id from report where report_name='Receipts And Payments'), 
                    'Receipts And Payments', 'receipts_and_payments', 'ReceiptsAndPayments.prpt');
            
            /* INCOME AND EXPENDITURE REPORT */
            
            insert into lookup_value(lookup_id,entity_id,lookup_name) values((select max(lv.lookup_id)+1 from
                lookup_value lv), 87, 'Permissions-CanViewIncomeAndExpenditureReport');
            
            insert into lookup_value_locale(locale_id,lookup_id,lookup_value) values
                (1,(select lookup_id from lookup_value where entity_id =87 and
                lookup_name='Permissions-CanViewIncomeAndExpenditureReport'),'Can view Income And Expenditure report');
            
            insert into activity(activity_id,parent_id, activity_name_lookup_id, DESCRIPTION_lookup_id) 
                values(324,317,(select lookup_id from lookup_value where entity_id =87 and
                    lookup_name='Permissions-CanViewIncomeAndExpenditureReport'),
                    (select lookup_id from lookup_value where entity_id =87 and
                    lookup_name='Permissions-CanViewIncomeAndExpenditureReport'));
            
            insert into roles_activity(activity_id, role_id) values(324, 1);
            
            insert into report(report_id, report_category_id, report_name, report_identifier, activity_id, report_active)
                values((select max(rid.report_id)+1 from report rid), 
                    (select rci.report_category_id from report_category rci where rci.report_category_value='Financial Accounting'), 
                    'Income And Expenditure', 'income_and_expenditure', 324, 1);
            
            insert into report_jasper_map(report_id, report_name, report_identifier, report_jasper) 
                values((select report_id from report where report_name='Income And Expenditure'), 
                    'Income And Expenditure', 'income_and_expenditure', 'IncomeAndExpenditure.prpt');
            
            /* CASH BALANCE REPORT */
            
            insert into lookup_value(lookup_id,entity_id,lookup_name) values((select max(lv.lookup_id)+1 from
                lookup_value lv), 87, 'Permissions-CanViewCashBalanceReport');
            
            insert into lookup_value_locale(locale_id,lookup_id,lookup_value) values
                (1,(select lookup_id from lookup_value where entity_id =87 and
                lookup_name='Permissions-CanViewCashBalanceReport'),'Can view Cash Balance report');
            
            insert into activity(activity_id,parent_id, activity_name_lookup_id, DESCRIPTION_lookup_id) 
                values(325,317,(select lookup_id from lookup_value where entity_id =87 and
                    lookup_name='Permissions-CanViewCashBalanceReport'),
                    (select lookup_id from lookup_value where entity_id =87 and
                    lookup_name='Permissions-CanViewCashBalanceReport'));
            
            insert into roles_activity(activity_id, role_id) values(325, 1);
            
            insert into report(report_id, report_category_id, report_name, report_identifier, activity_id, report_active)
                values((select max(rid.report_id)+1 from report rid), 
                    (select rci.report_category_id from report_category rci where rci.report_category_value='Financial Accounting'), 
                    'Cash Balance', 'cash_balance', 325, 1);
            
            insert into report_jasper_map(report_id, report_name, report_identifier, report_jasper) 
                values((select report_id from report where report_name='Cash Balance'), 
                    'Cash Balance', 'cash_balance', 'CashBalance.prpt');
                    
            create or replace view v_coa  as 
                select parent_coaid p_coaid, co.coa_name p_coa, co.glcode_id p_glcode_id, gl.glcode_value p_glcode_value,
                coo.coa_id, coo.coa_name,gll.glcode_id,gll.glcode_value
                          from coahierarchy c
                               left join coa co
                                  on co.coa_id = c.parent_coaid 
                               left join gl_code gl
                                  on gl.glcode_id = co.glcode_id
                               left join coa coo
                                  on coo.coa_id = c.coa_id
                               left join gl_code gll
                                  on gll.glcode_id = coo.glcode_id;
                             
            create or replace view v_coa6 as
                select 
                    c1.p_glcode_value p_gl1 ,c1.glcode_value gl1,c1.coa_id cid1, c1.coa_name coa1, 
                    c2.p_glcode_value p_gl2,c2.glcode_value gl2,c2.coa_id cid2,c2.coa_name coa2,
                    c3.p_glcode_value p_gl3,c3.glcode_value gl3,c3.coa_id cid3,c3.coa_name coa3,
                    c4.p_glcode_value p_gl4,c4.glcode_value gl4,c4.coa_id cid4,c4.coa_name coa4,
                    c5.p_glcode_value p_gl5,c5.glcode_value gl5,c5.coa_id cid5,c5.coa_name coa5,
                    c6.p_glcode_value p_gl6,c6.glcode_value gl6,c6.coa_id cid6,c6.coa_name coa6
                from 
                    v_coa c1
                    left join v_coa c2
                    on  c1.glcode_value=c2.p_glcode_value
                    left join v_coa c3
                    on  c2.glcode_value=c3.p_glcode_value
                    left join v_coa c4
                    on  c3.glcode_value=c4.p_glcode_value
                    left join v_coa c5
                    on  c4.glcode_value=c5.p_glcode_value
                    left join v_coa c6
                    on  c5.glcode_value=c6.p_glcode_value;
        </sql>
        <rollback>
            <sql endDelimiter=";">
                delete from report_jasper_map where report_identifier = 'transaction_details';
                delete from report_jasper_map where report_identifier = 'financial_transaction_summary';
                delete from report_jasper_map where report_identifier = 'general_ledger';
                delete from report_jasper_map where report_identifier = 'trial_balance';
                delete from report_jasper_map where report_identifier = 'trial_balance_v2';
                delete from report_jasper_map where report_identifier = 'receipts_and_payments';
                delete from report_jasper_map where report_identifier = 'income_and_expenditure';
                delete from report_jasper_map where report_identifier = 'cash_balance';
                
                delete from report where report_identifier = 'transaction_details';
                delete from report where report_identifier = 'financial_transaction_summary';
                delete from report where report_identifier = 'general_ledger';
                delete from report where report_identifier = 'trial_balance';
                delete from report where report_identifier = 'trial_balance_v2';
                delete from report where report_identifier = 'receipts_and_payments';
                delete from report where report_identifier = 'income_and_expenditure';
                delete from report where report_identifier = 'cash_balance';
                
                delete from roles_activity where activity_id between 318 and 325;
                delete from activity where activity_id between 318 and 325;
                
                delete from roles_activity where activity_id = 317;
                delete from report_category where report_category_value = 'Financial Accounting';
                delete from activity where activity_id = 317;
                
                delete from lookup_value_locale where lookup_id = 
                    (select lookup_id from lookup_value where lookup_name='Permissions-CanViewTransactionDetailsReport');
                delete from lookup_value_locale where lookup_id = 
                    (select lookup_id from lookup_value where lookup_name='Permissions-CanViewFinancialTransactionSummaryReport');
                delete from lookup_value_locale where lookup_id = 
                    (select lookup_id from lookup_value where lookup_name='Permissions-CanViewGeneralLedgerReport');
                delete from lookup_value_locale where lookup_id = 
                    (select lookup_id from lookup_value where lookup_name='Permissions-CanViewTrialBalanceReport');
                delete from lookup_value_locale where lookup_id = 
                    (select lookup_id from lookup_value where lookup_name='Permissions-CanViewTrialBalanceV2Report');
                delete from lookup_value_locale where lookup_id = 
                    (select lookup_id from lookup_value where lookup_name='Permissions-CanViewReceiptsAndPaymentsReport');
                delete from lookup_value_locale where lookup_id = 
                    (select lookup_id from lookup_value where lookup_name='Permissions-CanViewIncomeAndExpenditureReport');
                delete from lookup_value_locale where lookup_id = 
                    (select lookup_id from lookup_value where lookup_name='Permissions-CanViewCashBalanceReport');
                delete from lookup_value_locale where lookup_id = 
                    (select lookup_id from lookup_value where lookup_name='Permissions-FinancialAccounting');
                
                delete from lookup_value where entity_id = 87 and lookup_name = 'Permissions-CanViewTransactionDetailsReport';
                delete from lookup_value where entity_id = 87 and lookup_name = 'Permissions-CanViewFinancialTransactionSummaryReport';
                delete from lookup_value where entity_id = 87 and lookup_name = 'Permissions-CanViewGeneralLedgerReport';
                delete from lookup_value where entity_id = 87 and lookup_name = 'Permissions-CanViewTrialBalanceReport';
                delete from lookup_value where entity_id = 87 and lookup_name = 'Permissions-CanViewTrialBalanceV2Report';
                delete from lookup_value where entity_id = 87 and lookup_name = 'Permissions-CanViewReceiptsAndPaymentsReport';
                delete from lookup_value where entity_id = 87 and lookup_name = 'Permissions-CanViewIncomeAndExpenditureReport';
                delete from lookup_value where entity_id = 87 and lookup_name = 'Permissions-CanViewCashBalanceReport';
                delete from lookup_value where entity_id = 87 and lookup_name = 'Permissions-FinancialAccounting';
            </sql>
        </rollback>
    </changeSet>

</databaseChangeLog>
